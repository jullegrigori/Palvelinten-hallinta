# Kotitehtävä H1

## Saltin asentaminen

Tehtävänanto (Lähde 1):
```
a) Asenna Salt ja siihen uusi orja. Voit tehdä ne esimerkiksi uudelle virtuaalikoneelle, niin pääset kokeilemaan puhtaalta pöydältä.
```
Päätin asentaa saltin masterin heti palvelimelle, joka näkyy internettiin. Teen siis samalla tehtävänannon kohtaa f).

Yhdistin ssh-yhteyden yli palvelimeeni ja aloitin saltin masterin ja minion -osien asentamisen samalle palvelimelle seuraavilla komennoilla (Liite 2):

```
$ sudo apt-get update
$ sudo apt-get -y install salt-master salt-minion
```

Minion-palvelimen yhdistämistä varten tarvitaan /etc/salt/minion -tiedoston muokkausta. Tiedosto muokataan siis minion-palvelimen puolella ja siihen lisätään master:n IP-osoitetiedot. Samaan tiedostoon voi minionille konfiguroida selkokielisen ID:n. Master-palvelimen puolella ajettu hostname-komento parametrilla I antaa meille master:n IP-osoitetiedot. Tässä esimerkissa siis sekä master, että minion on sama palvelin:

```
$ hostname -I
164.68.XXX.XXX
$ sudo nano /etc/salt/minion
```

Lisäsin tiedoston alkuun tietoa masterin IP-osoitteesta. id-tunnisteeksi laitoin "mastah", koska tässä tilanteessa minioni toimii samalla masterina:
```
master: 164.68.XXX.XXX
id: mastah
```
Joka kerta kun minion-tiedostoa muokataan, salt-minion -palvelu pitää käynnistää uudelleen:
```
$ sudo systemctl restart salt-minion
````
Nyt, kun minion-palvelu tietää masterin IP-osoitteen, voidaan uudelle minionille generoida avain:
```
$ sudo salt-key -A
Unaccepted Keys:
mastah
Proceed? [n/Y]
Key for minion mastah accepted.
```
Tämän jälkeen minion yhdistää master-palvelimeen.


```
$ sudo salt '*' cmd.run 'whoami'
$ sudo salt '*' cmd.run 'hostname -I'

$ sudo salt '*' grains.items|less

```




Tehtävänanto jatkuu:
```
b) Tee saltille idempotentti hei maailma (siis tiedostosta, foo.sls)
```

```
d) Kerää tietoa koneesta saltin avulla (grains.items)
```

```
e) Kokeile jotain toista tilaa kuin file.managed. Tärkeitä ovat pkg.installed, file.managed, service.running, file.symlink, user.present, group.present. Ohjeita saa esim "sudo salt '*' sys.state_doc pkg.installed|less"
```

```
f) Vapaaehtoinen: Laita Salt Master palvelimelle, joka näkyy Internetiin. Silloin orjat saavat siihen yhteyden tulimuurin läpi, ei-julkisista (NAT) osoitteista ja vaikkapa virtuaalikoneista.
```


## Lähteet

1:
https://terokarvinen.com/2021/configuration-management-systems-palvelinten-hallinta-ict4tn022-spring-2021/

2:
http://terokarvinen.com/2018/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/index.html?fromSearch=



